# 开发计划

开发计划分2个大版本。

- 单机试验版

    - 基础玩法：
        - 单数据体系，无副本，保存一份英雄状态即可。战斗后不恢复
        - 文件系统落地数据，简化数据加载存储方式
        - 简单设计几个关卡
            - 每个关卡可以挂机，关卡难度决定遇到的对手团队的强度，和掉落物品等级
        - 可以查看战斗历史
            - 可以点击历史明细，文字重播当时战斗情况
    - 开发battle v0.1
        - (DONE)定义战场位置、对战双方等基础规则
        - 定义 hero 类，表示一个人物
            - (DONE)阵营系统
            - (DONE)职业系统
            - (DONE)属性系统
            - (DONE)星级系统
            - (DONE)持有技能
        - (DONE)战斗报告
            - （DONE）可以监听战场所有发生的事件
            - （DONE）按照发生时刻，形成结构化日志
            - (DONE)单元测试,模拟完整的一场战斗，并检查日志是否完备
                - （DONE）玩家hero初始化的时候，context是整个游戏世界
                - （DONE）玩家hero加入战斗的时候，hero.copy(battle),使得hero进入一场战斗上下文
                - （DONE）shero创建之后，会自动触发自身的被动技能。
                - (DONE)测试结束的时候，写文件输出2类json报告:
                    - battle记录，记录战斗双方简要信息（做列表展示）
                    - battle详情，记录战斗详细过程(做动画回放)
                - (DONE)开发图形界面，根据battle.detail里的信息，完整展示战斗过程
                    - (DONE)增加伤害、治疗统计
                    - （DONE)需要实现battleDetail需要的各种对象的toJSON(option)方法
                        - 根据输入参数，决定序列化的粒度粗细
                        - 最好还可以实现fromJSON(context,json)方法
                    - (DONE)把action,mutation之间的动画播放间隔加上
                    - (DONE)实现躲避、暴击、受到伤害等效果的展示
                        - (DONE)攻击者：边框变色，卡牌变大，位移
                        - (DONE)所有事件日志显示适配
                            - 收到伤害
                            - 躲避
                            - 被暴击
                        - (DONE)属性变化
                            - 数值增加:
                                - 绿色数字上浮
                            - 数值减少:
                                - 红色数字落地
                        - (DONE)躲避:边框绿色闪过，日志增加
                        - (DONE)暴击:剧烈抖动，日志增加

        - (DONE)Action
            - 英雄行为
            - 对技能的使用，都在Action里
        - (DONE)Team
            - 队伍系统：占位、人数
        - (DONE)Mutation
            - 状态修改
            - 对英雄属性、效果的修改，都在Mutation里
            - (DONE)战斗报告里，属性变化事件，订阅mutation而不是attrChange来完成（因为需要remark信息)
        - (DONE)定义战斗流程
            - 能量槽、主动、被动技能
        - (DONE)完成单元测试，能够后台进行完整的对战流程

    - (ing)开发基础技能体系
        - (DONE)完善主动、被动技能的触发方式
        - 把常用的效果都进行丰富
            - (DONE)基类
                - 增加效果param的通用参数
                    - category:效果分类（单独定义enum来维护)
                        - 正面
                        - 负面
            - (DONE)普通攻击
            - (ing)重生
            - (DONE)行为控制效果类
                - (DONE)眩晕
                - (DONE)冰冻
                - (DONE)沉默（封印）
            - (ing)中毒效果
                - 参数
                    - 是否致死
                    - 回合数
                    - 伤害量
            - (ing)效果清除类
                - 参数
                    - 要清除的效果名/分类名
                    - 清除多少级以下的效果(随等级增长)
        - (ing)设计几个初始技能用于测试
            - 被动技能（20个）
            - 主动技能 （10个）
        - (ing)完善测试用例
            - chooser 测试
            - effect 测试
                - 各种效果（眩晕、冰冻），对hero的canAction,canSkill的影响
        - (DONE)问题解决
            - (DONE)HP,HP_MAX(SP,SP_MAX)之间的关系，还未实现
                - (DONE)当MAX变化的时候，需要自动更新HP的值，如果HP>HP_MAX,需要修改


    - (ing)开发用户、物品、背包体系
        - 创建player概念
        - player具有物品资源列表
            - 不管是角色已经装备的，还是资源，所有物品统一记录在列表
            - 通过物品位置记录物品的所在：
                - 0:列表
                - 1:hero对象，表示在hero身上装备
        - 角色具有装备列表
            -（角色不持有其他物品，只记录装备的物品）
            - 角色的装备列表引用物品列表的id
        - 把用户、背包数、卡片角色进行对应
        - 搭建整体经济体系：金币、钻石、经验石、其他材料
        - 开发简易的合成公式体系
        - 开发完整的装备体系
        - 完善测试用例

    - (ing)设计抽奖系统
        - 可用树形结构定义事件概率分布
        - 对于挂机领取类的奖励，要根据挂机时间，拆分成多次领取，以减少概率对单次事件的影响
            - 比如挂机8小时，可以以10分钟为单位，拆分为多次领取
        - 事件可以自定义，比如：
            - 获取物品A
                - [0,10]个 (30%)
                - [11,20]个 (30%)
                - [21,30]个 (40%)

    - (DONE)开发level包
        - 表示等级、可升级对象

    - (DONE)画出领域模型关系图，和代码一致
    - (DONE)开发effect ，增加params.continueTurn
        - 表示持续若干回合的效果
            - 这类效果内部会记录一个持续回合数
            - 这类效果会订阅target上一个特殊的生命周期"AFTER_CHAR_ACTION"
            - 在角色行动结束之后，效果会减少持续回合数，如果为0，则自动触发uninstall

    - (DONE)开发Skill包
        - (DONE)Skill 继承自 levelable,表示是一个可以升级的东西
        - (DONE)Skill 包含Skill Item,Skill Item 包含若干个effect
        - (DONE)skillItem.toString实现
        - (DONE)effect.toString实现
    - (DONE)实现概率模块


- 单机实验加强版

    - 玩法加强：
    - 物品增多：
    - 英雄、技能增多
    - 模拟战斗工具
        - 功能：
            - 可以让一个人使用这个工具，可视化的编辑：
                - 技能组成
                - 队伍组成
                - 人物属性
            - 可以直接选择队伍进行模拟战斗，并查看战斗结果
            - 可以保存基本技能构成、英雄构成
        - 目的：
            - 交给xxx帮我进行数值策划和设计调整
            - 发现可能的实现的bug
- 网络版：

    - 数据落地
        - 数据库选型
        - 服务重启之后，玩家登录之后，数据初始化问题
            - 考虑从Player类一直到Hero类，都支持随时把自己序列化到数据库，以及从数据库读取的功能


    - 开发基础玩法0.1
        - PVE
            - 区域搜索与挂机战斗
        - PVP
            - 开发简单的竞技场体系
            - 竞技场排名每分钟都可以获取收益（而不是按点结算)

    - 完善组队战斗
        - 实现阵营光环机制
    - 数值策划
        - 经验值曲线
        - 衍生属性计算公式
    - 完善数据统计
        - 战斗报告，增加暴击次数、躲避次数、大招次数 统计
    - 性能优化
        - 属性压缩：
            - 目前使用字符串存储attrCarrier里的属性，其实后面可以考虑使用数组
            - 使用枚举+iota的方式，一个整数下标表示一个属性名
            - 数据库存储可以直接数组存储

- iota当前分配到:
    - 900(effectAndAttrCarrier)
    - 1000(hero)